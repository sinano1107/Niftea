{"remainingRequest":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/choumasateru/Desktop/development_direction/vue/niftea/src/components/NowSeatCard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/src/components/NowSeatCard.vue","mtime":1578226723249},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZS9hcHAnCmltcG9ydCAnZmlyZWJhc2UvZGF0YWJhc2UnCmltcG9ydCAnZmlyZWJhc2Uvc3RvcmFnZScKaW1wb3J0IEluZGV0ZXJtaW5hdGUgZnJvbSAnLi9JbmRldGVybWluYXRlJwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93OiBmYWxzZSwKICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgdXNlckRhdGE6IFtdLAogICAgICBpbWdVUkw6IHt9CiAgICB9CiAgfSwKICBwcm9wczogWydpZCddLAogIGNvbXBvbmVudHM6IHsKICAgIEluZGV0ZXJtaW5hdGUKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmluaXQoKQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgaW5pdCgpIHsKICAgICAgbGV0IG5vd0RhdGEgPSBhd2FpdCB0aGlzLmdldE5vd0RhdGEoKQogICAgICBsZXQgaW1nTGlzdCA9IFtdCgogICAgICBmb3IgKGxldCBpPTA7IGk8bm93RGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGltZ0xpc3QucHVzaChhd2FpdCB0aGlzLmdldFVzZXJEYXRhKG5vd0RhdGFbaV0pKQogICAgICB9CgogICAgICBmb3IgKGxldCBpPTA7IGk8aW1nTGlzdC5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuaW1nVVJMW2ltZ0xpc3RbaV1dID0gYXdhaXQgdGhpcy5nZXRVc2VySW1nKGltZ0xpc3RbaV0pCiAgICAgIH0KCiAgICAgIC8vIHRoaXMubG9hZGluZ+OCkmZhbHNl44Gr44GZ44KLCiAgICAgIHRoaXMubG9hZGluZyA9IGZhbHNlCiAgICB9LAogICAgZ2V0Tm93RGF0YSgpIHsKICAgICAgbGV0IGRhdGFiYXNlID0gZmlyZWJhc2UuZGF0YWJhc2UoKQogICAgICBsZXQgbm93ID0gZGF0YWJhc2UucmVmKGBzZWF0cy9Ob3cvJHt0aGlzLmlkfWApCiAgICAgIGxldCBzZWxmID0gdGhpcwoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICBub3cub24oJ3ZhbHVlJywgKHNuYXBzaG90KT0+IHsKICAgICAgICAgIGxldCB2YWwgPSBzbmFwc2hvdC52YWwoKQogICAgICAgICAgLy8gbmls44KS5raI44GZCiAgICAgICAgICB2YWwgPSB2YWwuZmlsdGVyKGZ1bmN0aW9uKCBpdGVtICkgeyByZXR1cm4gaXRlbSAhPSAibmlsIiB9KQogICAgICAgICAgLy8gdmFs44Gr5YCk44GM5a2Y5Zyo44GZ44KM44GwdGhpcy5zaG9344KSdHJ1ZeOBq+OBmeOCiwogICAgICAgICAgaWYgKHZhbC5sZW5ndGggPiAwKSB7CiAgICAgICAgICAgIHNlbGYuc2hvdyA9IHRydWUKICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUodmFsKQogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgZ2V0VXNlckRhdGEodWlkKSB7CiAgICAgIGxldCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCkKICAgICAgbGV0IHNlbGYgPSB0aGlzCgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgIGxldCB1c2VyRGF0YSA9IGRhdGFiYXNlLnJlZihgL3VzZXJzLyR7dWlkfWApCiAgICAgICAgdXNlckRhdGEub24oJ3ZhbHVlJywgKHNuYXBzaG90KT0+IHsKICAgICAgICAgIGxldCB2YWwgPSBzbmFwc2hvdC52YWwoKQogICAgICAgICAgc2VsZi51c2VyRGF0YS5wdXNoKHZhbCkKICAgICAgICAgIHJlc29sdmUodmFsLmltZykKICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGdldFVzZXJJbWcoaW1nKSB7CgoKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICBsZXQgc3RvcmFnZSA9IGZpcmViYXNlLnN0b3JhZ2UoKQogICAgICAgIGxldCBpbWdSZWYgPSBzdG9yYWdlLnJlZihgJHtpbWd9YCkKICAgICAgICBpbWdSZWYuZ2V0RG93bmxvYWRVUkwoKS50aGVuKCh1cmwpPT4gewogICAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpCiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2Jsb2InCiAgICAgICAgICB4aHIub25sb2FkID0gKCk9PiB7CiAgICAgICAgICAgIGxldCBibG9iID0geGhyLnJlc3BvbnNlCiAgICAgICAgICAgIHJlc29sdmUoVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSkKICAgICAgICAgIH0KICAgICAgICAgIHhoci5vcGVuKCdHRVQnLCB1cmwpCiAgICAgICAgICB4aHIuc2VuZCgpCiAgICAgICAgfSkKICAgICAgfSkKCgoKICAgIH0KICB9Cn0K"},{"version":3,"sources":["NowSeatCard.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;AAIA;AACA;AACA","file":"NowSeatCard.vue","sourceRoot":"src/components","sourcesContent":["<template lang=\"html\">\n  <v-hover v-slot:default=\"{ hover }\">\n    <v-card\n      class=\"mx-auto\"\n      max-width=\"344\"\n      :elevation=\"hover ? 12 : 2\"\n    >\n      <v-list-item three-line>\n        <v-list-item-content>\n          <div class=\"overline mb-4\">グループ{{ id+1 }}</div>\n\n          <v-chip-group\n            column\n            active-class=\"primary--text\"\n            v-if=\"show\"\n          >\n            <Indeterminate v-if=\"loading\" />\n            <v-chip v-else v-for=\"(item,i) in userData\" :key=\"i\">\n              <v-avatar left>\n                <v-img :src=\"imgURL[item.img]\"></v-img>\n              </v-avatar>\n              {{ item.realName }}\n            </v-chip>\n          </v-chip-group>\n\n          <v-list-item-subtitle v-else>だれもいません</v-list-item-subtitle>\n        </v-list-item-content>\n\n\n      </v-list-item>\n    </v-card>\n  </v-hover>\n</template>\n\n<script>\nimport firebase from 'firebase/app'\nimport 'firebase/database'\nimport 'firebase/storage'\nimport Indeterminate from './Indeterminate'\n\nexport default {\n  data() {\n    return {\n      show: false,\n      loading: true,\n      userData: [],\n      imgURL: {}\n    }\n  },\n  props: ['id'],\n  components: {\n    Indeterminate\n  },\n  created() {\n    this.init()\n  },\n  methods: {\n    async init() {\n      let nowData = await this.getNowData()\n      let imgList = []\n\n      for (let i=0; i<nowData.length; i++) {\n        imgList.push(await this.getUserData(nowData[i]))\n      }\n\n      for (let i=0; i<imgList.length; i++) {\n        this.imgURL[imgList[i]] = await this.getUserImg(imgList[i])\n      }\n\n      // this.loadingをfalseにする\n      this.loading = false\n    },\n    getNowData() {\n      let database = firebase.database()\n      let now = database.ref(`seats/Now/${this.id}`)\n      let self = this\n\n      return new Promise(function(resolve) {\n        now.on('value', (snapshot)=> {\n          let val = snapshot.val()\n          // nilを消す\n          val = val.filter(function( item ) { return item != \"nil\" })\n          // valに値が存在すればthis.showをtrueにする\n          if (val.length > 0) {\n            self.show = true\n          }\n          resolve(val)\n        })\n      })\n    },\n    getUserData(uid) {\n      let database = firebase.database()\n      let self = this\n\n      return new Promise(function(resolve) {\n        let userData = database.ref(`/users/${uid}`)\n        userData.on('value', (snapshot)=> {\n          let val = snapshot.val()\n          self.userData.push(val)\n          resolve(val.img)\n        })\n      })\n    },\n    getUserImg(img) {\n\n\n      return new Promise(function(resolve) {\n        let storage = firebase.storage()\n        let imgRef = storage.ref(`${img}`)\n        imgRef.getDownloadURL().then((url)=> {\n          let xhr = new XMLHttpRequest()\n          xhr.responseType = 'blob'\n          xhr.onload = ()=> {\n            let blob = xhr.response\n            resolve(URL.createObjectURL(blob))\n          }\n          xhr.open('GET', url)\n          xhr.send()\n        })\n      })\n\n\n\n    }\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n</style>\n"]}]}