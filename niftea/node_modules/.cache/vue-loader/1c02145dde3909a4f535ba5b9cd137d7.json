{"remainingRequest":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/choumasateru/Desktop/development_direction/vue/niftea/src/components/SeatCard.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/src/components/SeatCard.vue","mtime":1578226723251},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vuetify-loader/lib/loader.js","mtime":1574476662000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/choumasateru/Desktop/development_direction/vue/niftea/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBmaXJlYmFzZSBmcm9tICdmaXJlYmFzZS9hcHAnCmltcG9ydCAnZmlyZWJhc2UvZGF0YWJhc2UnCmltcG9ydCAnZmlyZWJhc2Uvc3RvcmFnZScKaW1wb3J0IEluZGV0ZXJtaW5hdGUgZnJvbSAnLi9JbmRldGVybWluYXRlJwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBzaG93OiBmYWxzZSwKICAgICAgbG9hZGluZzogdHJ1ZSwKICAgICAgcmVzZXJ2ZWQ6IGZhbHNlLAogICAgICBmaWx0ZXJfcmVzZXJ2ZXI6IFtdLAogICAgICByZXNlcnZlcjogW10sCiAgICAgIHJlc2VydmVyRGF0YToge30sCiAgICAgIGNvdW50OiAwLAogICAgICB0ZXh0OiAnJywgLy8g44K544OK44OD44Kv44OQ44O844Gu44OG44Kt44K544OICiAgICAgIHNuYWNrYmFyOiBmYWxzZQogICAgfQogIH0sCiAgcHJvcHM6IHtpZDogTnVtYmVyLCBkYXk6IFN0cmluZ30sCiAgY29tcG9uZW50czogewogICAgSW5kZXRlcm1pbmF0ZQogIH0sCiAgd2F0Y2g6IHsKICAgIGZpbHRlcl9yZXNlcnZlcjogZnVuY3Rpb24odmFsKSB7CiAgICAgIGlmICh2YWwubGVuZ3RoICE9IDApIHsKICAgICAgICB0aGlzLnNob3cgPSB0cnVlCiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy5zaG93ID0gZmFsc2UKICAgICAgfQogICAgICB0aGlzLmNvdW50ID0gdmFsLmxlbmd0aAogICAgICBsZXQgbXlVaWQgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXIudWlkCiAgICAgIHRoaXMucmVzZXJ2ZWQgPSBmYWxzZSAvLyDliJ3mnJ/ljJYKICAgICAgY29uc29sZS5kZWJ1Zyh2YWwpCiAgICAgIGZvciAobGV0IGk9MDsgaTx2YWwubGViZ3RoOyBpKyspIHsKICAgICAgICBpZiAodmFsW2ldID09IG15VWlkKSB7IHRoaXMucmVzZXJ2ZWQgPSB0cnVlIH0KICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMuZ2V0UmVzZXJ2ZXJEYXRhKCkKICB9LAogIG1ldGhvZHM6IHsKICAgIGluaXQoKSB7CiAgICAgIHRoaXMuc2hvdyA9IGZhbHNlCiAgICAgIHRoaXMubG9hZGluZyA9IHRydWUKICAgICAgdGhpcy5yZXNlcnZlZCA9IGZhbHNlCiAgICAgIHRoaXMuZmlsdGVyX3Jlc2VydmVyID0gW10KICAgICAgdGhpcy5yZXNlcnZlciA9IFtdCiAgICAgIHRoaXMucmVzZXJ2ZXJEYXRhID0ge30KICAgICAgdGhpcy5jb3VudCA9IDAKICAgICAgdGhpcy5nZXRSZXNlcnZlckRhdGEoKQogICAgfSwKICAgIGFzeW5jIGdldFJlc2VydmVyRGF0YSgpIHsKICAgICAgbGV0IHNlbGYgPSB0aGlzCiAgICAgIGxldCBteVVpZCA9IGZpcmViYXNlLmF1dGgoKS5jdXJyZW50VXNlci51aWQKCiAgICAgIGxldCByZXNlcnZlciA9IGF3YWl0IHNlbGYuZ2V0UmVzZXJ2ZXIoKQogICAgICBjb25zb2xlLmxvZyhyZXNlcnZlcikKCgogICAgICBzZWxmLmNvdW50ID0gcmVzZXJ2ZXIubGVuZ3RoCiAgICAgIGlmIChyZXNlcnZlci5sZW5ndGggPiAwKSB7CiAgICAgICAgLy8gcmVzZXJ2ZXLjgavoh6rliIbjga5pZOOBjOOBguOCi+OBi+OBp3Jlc2VydmVk44KSdHJ1ZQogICAgICAgIGZvciAobGV0IGk9MDsgaTxyZXNlcnZlci5sZW5ndGg7IGkrKykgewogICAgICAgICAgaWYgKHJlc2VydmVyW2ldID09IG15VWlkKSB7IHRoaXMucmVzZXJ2ZWQgPSB0cnVlIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGk9MDsgaTxyZXNlcnZlci5sZW5ndGg7IGkrKykgewogICAgICAgIGxldCB1c2VyRGF0YSA9IGF3YWl0IHNlbGYuZ2V0VXNlckRhdGEocmVzZXJ2ZXJbaV0pCiAgICAgICAgY29uc29sZS5kZWJ1Zyh1c2VyRGF0YSkKICAgICAgICBsZXQgdXNlckltZyA9IGF3YWl0IHNlbGYuZ2V0VXNlckltZyh1c2VyRGF0YS5pbWcpCiAgICAgICAgY29uc29sZS5kZWJ1Zyh1c2VySW1nKQogICAgICAgIGNvbnNvbGUubG9nKHJlc2VydmVyW2ldKQogICAgICAgIHNlbGYucmVzZXJ2ZXJEYXRhW3Jlc2VydmVyW2ldXSA9IHsibmFtZSI6IHVzZXJEYXRhLnJlYWxOYW1lLCAiaW1nIjogdXNlckltZ30KICAgICAgfQogICAgICBzZXRUaW1lb3V0KCgpPT4gewogICAgICAgIHNlbGYubG9hZGluZyA9IGZhbHNlCiAgICAgIH0sIDEwMDApCgogICAgfSwKICAgIGdldFJlc2VydmVyKCkgewogICAgICBjb25zdCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCkKICAgICAgbGV0IHNlbGYgPSB0aGlzCgogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgIGxldCBkYXRhID0gZGF0YWJhc2UucmVmKGAvc2VhdHMvJHtzZWxmLmRheX0vJHtzZWxmLmlkfWApCiAgICAgICAgZGF0YS5vbigndmFsdWUnLCAoc25hcHNob3QpPT4gewogICAgICAgICAgbGV0IHZhbCA9IHNuYXBzaG90LnZhbCgpCiAgICAgICAgICBjb25zb2xlLmxvZyh2YWwpCiAgICAgICAgICBzZWxmLnJlc2VydmVyID0gdmFsCiAgICAgICAgICB2YWwgPSB2YWwuZmlsdGVyKGZ1bmN0aW9uKCBpdGVtICkgeyByZXR1cm4gaXRlbSAhPSAibmlsIiB9KSAvLyBuaWzjgpLmtojjgZkKICAgICAgICAgIHNlbGYuZmlsdGVyX3Jlc2VydmVyID0gdmFsCiAgICAgICAgICBjb25zb2xlLmxvZyh2YWwpCiAgICAgICAgICByZXNvbHZlKHZhbCkKICAgICAgICB9KQogICAgICB9KQogICAgfSwKICAgIGdldFVzZXJEYXRhKHVpZCkgewogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSkgewogICAgICAgIGxldCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCkKICAgICAgICBsZXQgdXNlckRhdGEgPSBkYXRhYmFzZS5yZWYoYC91c2Vycy8ke3VpZH1gKQogICAgICAgIHVzZXJEYXRhLm9uKCd2YWx1ZScsIChzbmFwc2hvdCk9PiB7CiAgICAgICAgICByZXNvbHZlKHNuYXBzaG90LnZhbCgpKQogICAgICAgIH0pCiAgICAgIH0pCiAgICB9LAogICAgZ2V0VXNlckltZyhpbWcpIHsKICAgICAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICBsZXQgc3RvcmFnZSA9IGZpcmViYXNlLnN0b3JhZ2UoKQogICAgICAgIGxldCBpbWdSZWYgPSBzdG9yYWdlLnJlZihgJHtpbWd9YCkKICAgICAgICBpbWdSZWYuZ2V0RG93bmxvYWRVUkwoKS50aGVuKCh1cmwpPT4gewogICAgICAgICAgbGV0IHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpCiAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gJ2Jsb2InCiAgICAgICAgICB4aHIub25sb2FkID0gKCk9PiB7CiAgICAgICAgICAgIGxldCBibG9iID0geGhyLnJlc3BvbnNlCiAgICAgICAgICAgIHJlc29sdmUoVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSkKICAgICAgICAgIH0KICAgICAgICAgIHhoci5vcGVuKCdHRVQnLCB1cmwpCiAgICAgICAgICB4aHIuc2VuZCgpCiAgICAgICAgfSkKICAgICAgfSkKICAgIH0sCiAgICByZXNlcnZlKCkgewogICAgICBjb25zdCBkYXRhYmFzZSA9IGZpcmViYXNlLmRhdGFiYXNlKCkKICAgICAgY29uc3QgbXlVaWQgPSBmaXJlYmFzZS5hdXRoKCkuY3VycmVudFVzZXIudWlkIC8vIG15VWlkCiAgICAgIGNvbnN0IHNlbGYgPSB0aGlzCgoKICAgICAgdmFyIHJlc3VsdCA9IG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHsKICAgICAgICAvLyDoh6rliIbjgYzku5bjga7loLTmiYDjgavkuojntITjgZfjgabjgYTjgovloLTlkIjjgZ3jgozjgpLjgq3jg6Pjg7Pjgrvjg6vjgZnjgosKICAgICAgICBsZXQgc2VhcmNoTGlzdCA9IGRhdGFiYXNlLnJlZihgL3NlYXRzLyR7c2VsZi5kYXl9YCkKICAgICAgICBzZWFyY2hMaXN0Lm9uY2UoJ3ZhbHVlJywgKHNuYXBzaG90KT0+IHsKICAgICAgICAgIGxldCB2YWwgPSBzbmFwc2hvdC52YWwoKQogICAgICAgICAgY29uc29sZS5kZWJ1Zyh2YWwpCgogICAgICAgICAgc2VhcmNoX2xvb3A6CiAgICAgICAgICBmb3IgKGxldCBpZD0wOyBpZDwxNTsgaWQrKykgewogICAgICAgICAgICBmb3IgKGxldCBpPTA7IGk8NjsgaSsrKSB7CiAgICAgICAgICAgICAgaWYgKHZhbFtpZF1baV0gPT0gbXlVaWQpIHsKICAgICAgICAgICAgICAgIC8vIOimi+OBpOOBkeOBn+OCiW5pcuOBq+OBmeOCiwogICAgICAgICAgICAgICAgZGF0YWJhc2UucmVmKGBzZWF0cy8ke3NlbGYuZGF5fS8ke2lkfS8ke2l9YCkuc2V0KCJuaWwiKQogICAgICAgICAgICAgICAgYnJlYWsgc2VhcmNoX2xvb3AKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICAgIHJlc29sdmUoKQogICAgICAgIH0pCiAgICAgIH0pCgogICAgICByZXN1bHQudGhlbiggZnVuY3Rpb24oKSB7CiAgICAgICAgbGV0IHRhcmdldCA9IHNlbGYucmVzZXJ2ZXIuaW5kZXhPZigibmlsIikKICAgICAgICBpZiAodGFyZ2V0ID09IC0xKSB7CiAgICAgICAgICBjb25zb2xlLmRlYnVnKCLjgoLjgYbml6LjgavkuojntITjgZXjgozjgabjgYTjgb7jgZnjgILjg6rjg63jg7zjg4njgZfjgabjgY/jgaDjgZXjgYQiKQogICAgICAgICAgc2VsZi50ZXh0ID0gJ1vjgqjjg6njg7xd5LqI57SE44Gn44GN44G+44Gb44KT44Gn44GX44Gf44CC44Oa44O844K444KS44Oq44Ot44O844OJ44GX44Gm44GP44Gg44GV44GEJwogICAgICAgICAgc2VsZi5zbmFja2JhciA9IHRydWUKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGF0YWJhc2UucmVmKGBzZWF0cy8ke3NlbGYuZGF5fS8ke3NlbGYuaWR9LyR7dGFyZ2V0fWApLnNldChteVVpZCkKICAgICAgICAgIHNlbGYudGV4dCA9ICfkuojntITjgZfjgb7jgZfjgZ/vvIEnCiAgICAgICAgICBzZWxmLnNuYWNrYmFyID0gdHJ1ZQogICAgICAgIH0KICAgICAgICBzZWxmLmluaXQoKQogICAgICB9KQogICAgfSwKICAgIGNhbmNlbCgpIHsKICAgICAgY29uc3QgZGF0YWJhc2UgPSBmaXJlYmFzZS5kYXRhYmFzZSgpCiAgICAgIGNvbnN0IG15VWlkID0gZmlyZWJhc2UuYXV0aCgpLmN1cnJlbnRVc2VyLnVpZAoKICAgICAgbGV0IHRhcmdldCA9IHRoaXMucmVzZXJ2ZXIuaW5kZXhPZihteVVpZCkKICAgICAgZGF0YWJhc2UucmVmKGBzZWF0cy8ke3RoaXMuZGF5fS8ke3RoaXMuaWR9LyR7dGFyZ2V0fWApLnNldCgibmlsIikKICAgICAgdGhpcy5pbml0KCkKICAgICAgdGhpcy50ZXh0ID0gJ+S6iOe0hOOCkuOCreODo+ODs+OCu+ODq+OBl+OBvuOBl+OBnycKICAgICAgdGhpcy5zbmFja2JhciA9IHRydWUKICAgIH0sCiAgfQp9Cg=="},{"version":3,"sources":["SeatCard.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2GA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"SeatCard.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <v-snackbar\n      v-model=\"snackbar\"\n      top\n      right\n    >\n      {{ text }}\n      <v-btn\n        color=\"pink\"\n        text\n        @click=\"snackbar = false\"\n      >\n        Close\n      </v-btn>\n    </v-snackbar>\n\n    <v-hover v-slot:default=\"{ hover }\">\n      <v-card\n        class=\"mx-auto\"\n        max-width=\"344\"\n        :elevation=\"hover ? 12 : 2\"\n      >\n        <v-list-item three-line>\n          <v-list-item-content>\n            <div class=\"overline mb-4\">グループ{{ id+1 }}\n              <v-icon\n                color=\"red\"\n                v-if=\"(count == 6) && $vuetify.breakpoint.smAndDown\"\n              >mdi-close</v-icon>\n              <v-icon\n                color=\"light-green\"\n                v-else-if=\"(count <= 3) && $vuetify.breakpoint.smAndDown\"\n              >mdi-circle-double</v-icon>\n              <v-icon\n                color=\"blue\"\n                v-else-if=\"$vuetify.breakpoint.smAndDown\"\n              >mdi-triangle-outline</v-icon>\n            </div>\n\n\n\n            <v-chip-group\n              v-if=\"show && $vuetify.breakpoint.smAndDown\"\n            >\n              <Indeterminate v-if=\"loading\" />\n              <v-chip v-else v-for=\"(item,i) in filter_reserver\" :key=\"i\">\n                <v-avatar left>\n                  <v-img :src=\"reserverData[item]['img']\"></v-img>\n                </v-avatar>\n                {{ reserverData[item][\"name\"] }}\n              </v-chip>\n            </v-chip-group>\n            <v-chip-group\n              column\n              v-else-if=\"show\"\n            >\n              <Indeterminate v-if=\"loading\" />\n              <v-chip v-else v-for=\"(item,i) in filter_reserver\" :key=\"i\">\n                <v-avatar left>\n                  <v-img :src=\"reserverData[item]['img']\"></v-img>\n                </v-avatar>\n                {{ reserverData[item][\"name\"] }}\n              </v-chip>\n            </v-chip-group>\n\n            <v-list-item-subtitle v-else>だれもいません</v-list-item-subtitle>\n          </v-list-item-content>\n\n\n          <v-list-item-avatar\n            size=\"70\"\n            color=\"red\"\n            v-if=\"(count == 6) && $vuetify.breakpoint.mdAndUp\"\n          >\n            <v-icon x-large>mdi-close</v-icon>\n          </v-list-item-avatar>\n          <v-list-item-avatar\n            size=\"70\"\n            color=\"light-green\"\n            v-else-if=\"(count <= 3) && $vuetify.breakpoint.mdAndUp\"\n          >\n            <v-icon x-large>mdi-circle-double</v-icon>\n          </v-list-item-avatar>\n          <v-list-item-avatar\n            size=\"70\"\n            color=\"blue\"\n            v-else-if=\"$vuetify.breakpoint.mdAndUp\"\n          >\n            <v-icon x-large>mdi-triangle-outline</v-icon>\n          </v-list-item-avatar>\n\n\n\n\n        </v-list-item>\n\n        <v-card-actions>\n          <v-btn text v-if=\"reserved\" @click=\"cancel\">キャンセル</v-btn>\n          <v-btn text v-else-if=\"count!=6\" @click=\"reserve\">予約</v-btn>\n        </v-card-actions>\n      </v-card>\n    </v-hover>\n  </div>\n</template>\n\n<script>\nimport firebase from 'firebase/app'\nimport 'firebase/database'\nimport 'firebase/storage'\nimport Indeterminate from './Indeterminate'\n\nexport default {\n  data() {\n    return {\n      show: false,\n      loading: true,\n      reserved: false,\n      filter_reserver: [],\n      reserver: [],\n      reserverData: {},\n      count: 0,\n      text: '', // スナックバーのテキスト\n      snackbar: false\n    }\n  },\n  props: {id: Number, day: String},\n  components: {\n    Indeterminate\n  },\n  watch: {\n    filter_reserver: function(val) {\n      if (val.length != 0) {\n        this.show = true\n      } else {\n        this.show = false\n      }\n      this.count = val.length\n      let myUid = firebase.auth().currentUser.uid\n      this.reserved = false // 初期化\n      console.debug(val)\n      for (let i=0; i<val.lebgth; i++) {\n        if (val[i] == myUid) { this.reserved = true }\n      }\n    }\n  },\n  created() {\n    this.getReserverData()\n  },\n  methods: {\n    init() {\n      this.show = false\n      this.loading = true\n      this.reserved = false\n      this.filter_reserver = []\n      this.reserver = []\n      this.reserverData = {}\n      this.count = 0\n      this.getReserverData()\n    },\n    async getReserverData() {\n      let self = this\n      let myUid = firebase.auth().currentUser.uid\n\n      let reserver = await self.getReserver()\n      console.log(reserver)\n\n\n      self.count = reserver.length\n      if (reserver.length > 0) {\n        // reserverに自分のidがあるかでreservedをtrue\n        for (let i=0; i<reserver.length; i++) {\n          if (reserver[i] == myUid) { this.reserved = true }\n        }\n      }\n\n      for (let i=0; i<reserver.length; i++) {\n        let userData = await self.getUserData(reserver[i])\n        console.debug(userData)\n        let userImg = await self.getUserImg(userData.img)\n        console.debug(userImg)\n        console.log(reserver[i])\n        self.reserverData[reserver[i]] = {\"name\": userData.realName, \"img\": userImg}\n      }\n      setTimeout(()=> {\n        self.loading = false\n      }, 1000)\n\n    },\n    getReserver() {\n      const database = firebase.database()\n      let self = this\n\n      return new Promise(function(resolve) {\n        let data = database.ref(`/seats/${self.day}/${self.id}`)\n        data.on('value', (snapshot)=> {\n          let val = snapshot.val()\n          console.log(val)\n          self.reserver = val\n          val = val.filter(function( item ) { return item != \"nil\" }) // nilを消す\n          self.filter_reserver = val\n          console.log(val)\n          resolve(val)\n        })\n      })\n    },\n    getUserData(uid) {\n      return new Promise(function(resolve) {\n        let database = firebase.database()\n        let userData = database.ref(`/users/${uid}`)\n        userData.on('value', (snapshot)=> {\n          resolve(snapshot.val())\n        })\n      })\n    },\n    getUserImg(img) {\n      return new Promise(function(resolve) {\n        let storage = firebase.storage()\n        let imgRef = storage.ref(`${img}`)\n        imgRef.getDownloadURL().then((url)=> {\n          let xhr = new XMLHttpRequest()\n          xhr.responseType = 'blob'\n          xhr.onload = ()=> {\n            let blob = xhr.response\n            resolve(URL.createObjectURL(blob))\n          }\n          xhr.open('GET', url)\n          xhr.send()\n        })\n      })\n    },\n    reserve() {\n      const database = firebase.database()\n      const myUid = firebase.auth().currentUser.uid // myUid\n      const self = this\n\n\n      var result = new Promise(function(resolve) {\n        // 自分が他の場所に予約している場合それをキャンセルする\n        let searchList = database.ref(`/seats/${self.day}`)\n        searchList.once('value', (snapshot)=> {\n          let val = snapshot.val()\n          console.debug(val)\n\n          search_loop:\n          for (let id=0; id<15; id++) {\n            for (let i=0; i<6; i++) {\n              if (val[id][i] == myUid) {\n                // 見つけたらnirにする\n                database.ref(`seats/${self.day}/${id}/${i}`).set(\"nil\")\n                break search_loop\n              }\n            }\n          }\n          resolve()\n        })\n      })\n\n      result.then( function() {\n        let target = self.reserver.indexOf(\"nil\")\n        if (target == -1) {\n          console.debug(\"もう既に予約されています。リロードしてください\")\n          self.text = '[エラー]予約できませんでした。ページをリロードしてください'\n          self.snackbar = true\n        } else {\n          database.ref(`seats/${self.day}/${self.id}/${target}`).set(myUid)\n          self.text = '予約しました！'\n          self.snackbar = true\n        }\n        self.init()\n      })\n    },\n    cancel() {\n      const database = firebase.database()\n      const myUid = firebase.auth().currentUser.uid\n\n      let target = this.reserver.indexOf(myUid)\n      database.ref(`seats/${this.day}/${this.id}/${target}`).set(\"nil\")\n      this.init()\n      this.text = '予約をキャンセルしました'\n      this.snackbar = true\n    },\n  }\n}\n</script>\n\n<style lang=\"css\" scoped>\n</style>\n"]}]}